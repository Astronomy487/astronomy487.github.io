<!DOCTYPE html>
<html>
<head>
  <style>
    @font-face {
      font-family: "Edwin";
      src: url("Edwin-Roman.otf") format("opentype");
      font-weight: normal;
    }
    @font-face {
      font-family: "Edwin";
      src: url("Edwin-Bold.otf") format("opentype");
      font-weight: bold;
    }
    body {
      font-family: Edwin;
    }
    section {
      margin: 4rem auto;
      width: 32rem;
      position: relative;
    }
    
    section h2 {
      font-size: 2.5rem;
      font-weight: bold;
      text-align: center;
      position: absolute;
      top: 0;
      right: 0;
      margin: 0;
      height: 180px;
      width: 100%;
      text-align: right;
      background: linear-gradient(90deg, #ffffff00, #ffffff00, #ffffffdd, #ffffffee, white);
      box-sizing: border-box;
      padding-right: 4rem;
      line-height: 180px;
    }
  </style>
</head>
<body>
  <input>
  <div id="output"></div>
  <script src="chordanalysis.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/vexflow@4.2.3/build/cjs/vexflow.js"></script>
  <script src="vexflowwrite.js"></script>
  <script>
    let output = document.querySelector("#output");
    document.querySelector("input").focus();
    document.querySelector("input").value = "EM7/DM7";
    document.querySelector("input").oninput = function() {
      while (output.firstChild) output.firstChild.remove();
      for (let text of this.value.split(" ").filter(x => x.length).map(x => x.trim())) {
        let section = output.appendChild(document.createElement("section"));
        try {
          let analysisStack = chordStackAnalysis(text);
          let div = section.appendChild(document.createElement("div"));
          renderChords([simpleVoicingFromChordStack(analysisStack)], div, {availableWidth: 512, extraHeight: 30});
          let h2 = section.appendChild(document.createElement("h2"));
          h2.innerText = analysisStack.map(x => x.text).join("/");
          let p = section.appendChild(document.createElement("p"));
          p.innerHTML = analysisStack.reverse().map(x => x.memberNames.join(" ")).join(" / ");
        } catch(e) {
          console.log(e);
          /* let h2 = section.appendChild(document.createElement("h2"));
          h2.innerText = text;
          let p = section.appendChild(document.createElement("p"));
          p.innerText = e.toString(); */
          section.remove();
        }
      }
    }
  </script>
</body>
</html>