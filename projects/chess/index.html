<!DOCTYPE html>
<html>
<head>
  <link rel="icon" href="icon.png">
  <title>chess sandbox</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@500&display=swap');
    
    @font-face {
      font-family: "chess font";
      src: url('CASEFONT.TTF') format('truetype');
    }
    
    :root {
      --black: #292929;
      --white: #EDEDEA;
      --square-dark: #6388a5;
      --square-light: #afbecc;
      --color: #FF7300;
      /* --square-dark: #88a563;
      --square-light: #becf9f; */
    }
    
    body {
      user-select: none;
      margin: 0;
      background-color: var(--black);
      font-family: Inter, sans-serif;
      color: var(--white);
      overflow-x: hidden;
    }
    
    main {
      max-height: 94vh;
      margin-top: 3vh;
      position: absolute;
      width: 100%;
      top: 50%;
      transform: translateY(-50%) translateY(-3vh);
    }
    
    table {
      border-collapse: collapse;
      transition: transform 1s;
      margin: auto;
    }
    
    ::selection {
      background: var(--white);
      color: var(--black);
    }
    
    td {
      width: 5rem;
      height: 5rem;
      text-align: center;
      font-size: 4rem;
      background-color: var(--square);
    }
    
    td[parity="0"] {--square: var(--square-light); --not-square: var(--square-dark);}
    td[parity="1"] {--square: var(--square-dark); --not-square: var(--square-light);}
    
    span[team] {
      paint-order: stroke fill;
      -webkit-text-stroke: 0.125em var(--black);
      display: block;
      transition: transform 0s;
      text-shadow: 0 0.0625em 0.125em var(--black);
      font-family: 'chess font';
    }
    
    span[team="0"] {color: var(--white);}
    span[team="1"] {color: var(--black); -webkit-text-stroke-color: var(--white);}
    span[team="2"] {color: #3B4FE7;}
    span[team="3"] {color: #EE2B1A;}
    span[team="4"] {color: #ECAD19;}
    
    td[oob="true"] {
      opacity: 0;
    }
    
    td[highlight="owned"] {
      cursor: pointer;
    }
    td[highlight="origin"] {
      background-color: var(--color);
      cursor: pointer;
    }
    td[highlight="destination"] {
      cursor: pointer;
      box-shadow: inset 0.25rem 0.25rem var(--square), inset -0.25rem -0.25rem var(--square), inset 0.5rem 0.5rem var(--color), inset -0.5rem -0.5rem var(--color);
    }
    td[highlight="just_happened"] {
      box-shadow: inset 0.25rem 0.25rem var(--square), inset -0.25rem -0.25rem var(--square), inset 0.5rem 0.5rem var(--not-square), inset -0.5rem -0.5rem var(--not-square);
    }
    
    a {
      color: var(--color);
      text-decoration: none;
      cursor: pointer;
    }
    
    a:hover {
      text-decoration: underline;
    }
    
    button {
      background-color: var(--color);
      border: none;
      font-size: 1rem;
      font-family: inherit;
      width: 8rem;
      padding: 0.5rem 0;
      cursor: pointer;
      margin: 0;
      margin-top: 1rem;
      float: right;
    }
    
    button:hover {
      background-color: var(--white);
    }
    
    button:hover::after {
      content: ' ->';
    }
    
    #menu {
      width: 100%;
      user-select: text;
    }
    
    #menu h1 {
      font-weight: normal;
      text-align: center;
      font-size: 1.25rem;
      width: 28rem;
      margin: 0 auto;
      margin-top: 10rem;
      margin-bottom: -4rem;
      color: var(--color);
      text-transform: uppercase;
    }
    
    #menu h1::before {content: '— ';}
    #menu h1::after {content: ' —';}
    
    .setup {
      width: 28rem;
      margin: 6rem auto;
    }
    
    .setup h2 {
      font-size: 2rem;
      font-weight: normal;
      margin: 1rem 0;
      color: var(--color);
    }
    
    .setup button {
      background-color: var(--black);
      color: var(--white);
    }
    
    .setup button:hover {
      background-color: var(--color);
      color: var(--black);
    }
    
    #sidebar {
      position: fixed;
      width: 16rem;
      bottom: 0;
      left: 0;
      padding: 1rem;
      background-color: var(--black);
      font-size: 1.125rem;
    }
    
    #sidebar p {
      margin: 0;
      margin-top: 0.5rem;
    }
    
    #modal {
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      background-color: var(--black);
      width: 32rem;
      padding: 1rem 2rem;
      min-height: 16rem;
      /* border: solid 0.25rem var(--white);
      box-shadow: 0 0 1rem var(--black); */
    }
    
    #modal h1 {
      font-weight: normal;
      margin: 1rem 0;
      color: var(--color);
    }
    
    #modal div {
      margin: 0.25rem 0;
    }
    
    #modal label {
      margin-left: 1rem;
    }
    
    #modal hr {
      border: none;
      margin: 1rem 0;
      height: 0.125rem;
      background-color: var(--white);
      width: 50%;
    }
  </style>
  <style id="rotation_css"></style>
</head>
<body>
  <script src="script.js"></script>
  <script src="common_pieces.js"></script>
  <main><table id="display_table"></table></main> <!-- game board -->
  <div id="sidebar">
    <p id="current_turn_display"></p>
    <p><a onclick="window.location.href = (''+location).substring(0, (''+location).indexOf('?'));">Home</a></p>
  </div>
  <div id="menu"></div>
  <div id="modal"></div>
  <script>
    let gamerules = {};
    //each gamerule object has:
    // - name. actual display name (not the key, which goes in ? part of url)
    // - description.
    // - establish(). runs the stuff to get the board (and maybe c) set up
  </script>
  <script src="_standard.js"></script>
  <script src="_4.js"></script>
  <script src="_960.js"></script>
  <script src="_chaturanga.js"></script>
  <script src="_balbo.js"></script>
  <script src="_puzzle.js"></script>
  <script src="_mini.js"></script>
  <script src="_double.js"></script>
  
  <script src="_lol.js"></script>
  <script src="_totalrandom.js"></script>
  <script src="_spacious.js"></script>
  <script src="_checkers.js"></script>
  
  <script src="_2020.js"></script>
  <script src="_gay.js"></script>
  <script src="_guillotine.js"></script>
  <script>
    let filename = location.search;
    if (filename.startsWith("?")) filename = filename.substring(1);
    if (filename != "") {
      //we are playing game
      document.getElementById("menu").remove();
      //run appropriate script
      gamerules[filename].establish();
      //create the modal
      let html = '';
      html += '<h1>'+gamerules[filename].name+'</h1>';
      html += '<p>'+gamerules[filename].description+'</p>';
      teams = 0;
      for (row of board) for (cell of row) if (cell.team != undefined) teams = Math.max(teams, cell.team);
      teams++;
      for (let i = 0; i < teams; i++) {
        html += '<div><input type="checkbox" id="ai_checkbox_'+i+'"><label>'+team_names[i]+' player CPU?</label></div>';
      }
      html += '<hr><div><input type="checkbox" id="rotation_checkbox"><label>Rotate on new player?</label></div>';
      html += '<button onclick="start_game();">Start</button>';
      document.getElementById("modal").innerHTML = html;
    } else {
      //we are on home screen
      document.getElementById("sidebar").remove();
      document.getElementById("modal").remove();
      let html = '';
      for (variant of "standard 960 4 #predecessors chaturanga #different_board_shapes balbo puzzle mini double #silly lol totalrandom spacious checkers".split(" ")) {
        if (variant.startsWith("#")) {
          html += '<h1>'+variant.substring(1).replaceAll("_", " ")+'</h1>';
          continue;
        }
        html += '<div class="setup">';
        html += '<h2>' + gamerules[variant].name + '</h2>';
        html += '<p>' + gamerules[variant].description + '</h2>';
        html += '<button onclick="link_to_rules(\''+variant+'\')">Play</button>';
        html += '</div>';
      }
      document.getElementById("menu").innerHTML = html;
    }
    
    function link_to_rules(filename) {
      window.location.href = location + "?" + filename;
    }
  </script>
</body>
</html>