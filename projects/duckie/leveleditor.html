<!DOCTYPE html>
<html>
<head>
  <style>
    body {
      background-color: #472D3C;
      margin: 0;
      user-select: none;
    }
    
    table {
      border-collapse: collapse;
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%) scale(4);
      table-layout: fixed;
    }
    
    table td {
      width: 1rem;
      height: 1rem;
      background-size: cover;
      image-rendering: pixelated;
    }
    
    tr:nth-child(2n) td:nth-child(2n), tr:nth-child(2n+1) td:nth-child(2n+1) {background-color: #ffffff08;}
    
    table td img {
      width: 1rem;
      height: 1rem;
      display: block;
    }
    
    button {
      display: block;
      width: 2rem;
      height: 2rem;
      background-size: cover;
      image-rendering: pixelated;
      border: none;
      background-color: inherit;
      border: solid 2px #7A444A;
      margin: 2px;
    }
  </style>
</head>
<body>
  <textarea style="position: fixed; bottom: 0; left: 0; height: 50vh; width: 12rem;"></textarea>
  <table></table>
  <script>
    let height = 7;
    let width = 8;
    let bottom_elements = [];
    let top_elements = [];
    let selected_top_img = "art/empty.png";
    let selected_top_value = ".";
    let selected_bottom_img = "art/empty.png";
    let selected_bottom_value = ".";
    let last_used_top = false;
    for (let y = 0; y < height; y++) {
      let tr = document.createElement("tr");
      bottom_elements[y] = [];
      top_elements[y] = [];
      for (let x = 0; x < width; x++) {
        let td = document.createElement("td");
        tr.appendChild(td);
        bottom_elements[y][x] = td;
        td.setAttribute("y_coord", y);
        td.setAttribute("x_coord", x);
        td.setAttribute("background", "art/empty.png");
        td.setAttribute("value", ".");
        let img = document.createElement("img");
        td.appendChild(img);
        top_elements[y][x] = img;
        img.setAttribute("src", "art/empty.png");
        img.setAttribute("value", ".");
        td.onclick = function() {
          print();
          if (!last_used_top) {
            td.setAttribute("background", selected_bottom_img);
            td.setAttribute("value", selected_bottom_value);
          } else {
            img.setAttribute("src", selected_top_img);
            img.setAttribute("value", selected_top_value);
          }
        };
      }
      document.querySelector("table").appendChild(tr);
    }
 
 
 
 
  let arch_bottom = {
    //nothing's there
    ".": {img: "art/empty.png"},
    ",": {img: "art/ground0.png"},
    "i": {img: "art/ice.png", slippery: true},
    "w": {img: "art/conwayflooralive.png"},
    "s": {img: "art/conwayfloordead.png"},
    //goals
    "1": {img: "art/goal0.png", goal: 1},
    "2": {img: "art/goal1.png", goal: 2},
    "3": {img: "art/goal2.png", goal: 3},
    //boxdoor
    "!": {img: "art/boxdoor0closed.png", boxdoor: 1},
    "@": {img: "art/boxdoor1closed.png", boxdoor: 2},
    "#": {img: "art/boxdoor2closed.png", boxdoor: 3},
    ")": {img: "art/boxdoor0open.png", boxdoor: 1, invert: true},
    "(": {img: "art/boxdoor1open.png", boxdoor: 2, invert: true},
    "&": {img: "art/boxdoor2open.png", boxdoor: 3, invert: true},
    //exit
    "*": {img: "art/exit.png", exit: true},
    //stops!
    "[": {img: "art/riveredgeleft.png", stop: true},
    "]": {img: "art/riveredgeright.png", stop: true},
    "{": {img: "art/riveredgetop.png", stop: true},
    "}": {img: "art/riveredgebottom.png", stop: true},
    "=": {img: "art/riverfull.png", stop: true},
    "+": {img: "art/rivercornertopleft.png", stop: true},
    "-": {img: "art/rivercornertopright.png", stop: true},
    "_": {img: "art/rivercornerbottomleft.png", stop: true},
    ";": {img: "art/rivercornerbottomright.png", stop: true},
    "Q": {img: "art/walltopleft.png", stop: true},
    "W": {img: "art/walltop.png", stop: true},
    "E": {img: "art/walltopright.png", stop: true},
    "A": {img: "art/wallleft.png", stop: true},
    "S": {img: "art/wallinner.png", stop: true},
    "D": {img: "art/wallright.png", stop: true},
    "Z": {img: "art/wallbottomleft.png", stop: true},
    "X": {img: "art/wallbottom.png", stop: true},
    "C": {img: "art/wallbottomright.png", stop: true},
    "q": {img: "art/wallinnertopleft.png", stop: true},
    "e": {img: "art/wallinnertopright.png", stop: true},
    "z": {img: "art/wallinnerbottomleft.png", stop: true},
    "c": {img: "art/wallinnerbottomright.png", stop: true},
  };
  
  let arch_top = {
    //nothing's there
    ".": {img: "art/empty.png"},
    //something immovable is there
    "[": {img: "art/tree0.png", stop: true},
    "]": {img: "art/tree1.png", stop: true},
    "{": {img: "art/tree2.png", stop: true},
    "`": {img: "art/duckie.png", stop: true},
    //boxen
    "1": {img: "art/box0.png", box: 1},
    "2": {img: "art/box1.png", box: 2},
    "3": {img: "art/box2.png", box: 3, stop: true},
    //people
    "~": {img: "art/player.png", player: true, stop: true},
    "?": {img: "art/duckie.png", wanderer: true, stop: true},
    //uhhh other
    "$": {img: "art/crystalshard.png", collectable: true},
  };
  
  
  
 
 
    
    for (arch of Object.keys(arch_bottom)) {
      let button = document.createElement("button");
      button.setAttribute("url", arch_bottom[arch].img);
      button.setAttribute("value", arch);
      button.style.backgroundImage = 'url("'+arch_bottom[arch].img+'")';
      button.style.float = "left";
      button.onclick = function() {
        selected_bottom_img = this.getAttribute("url");
        selected_bottom_value = this.getAttribute("value");
        last_used_top = false;
      }
      document.body.appendChild(button);
    }
    
    for (arch of Object.keys(arch_top)) {
      let button = document.createElement("button");
      button.setAttribute("url", arch_top[arch].img);
      button.setAttribute("value", arch);
      button.style.backgroundImage = 'url("'+arch_top[arch].img+'")';
      button.style.float = "right";
      button.onclick = function() {
        selected_top_img = this.getAttribute("url");
        selected_top_value = this.getAttribute("value");
        last_used_top = true;
      }
      document.body.appendChild(button);
    }
    
    function print() {
      let txt = "";
      txt += "\ndata_bottom:";
      for (row of document.querySelectorAll("table tr")) {
        for (cell of row.querySelectorAll("td")) txt += cell.getAttribute("value");
        txt += "|";
      }
      txt = txt.substring(0, txt.length-1);
      txt += "\ndata_top:";
      for (row of document.querySelectorAll("table tr")) {
        for (cell of row.querySelectorAll("img")) txt += cell.getAttribute("value");
        txt += "|";
      }
      txt = txt.substring(0, txt.length-1);
      console.log(txt);
      document.querySelector("textarea").value = txt;
    }
  </script>
</body>
</html>